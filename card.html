<html>
	<head>
		<title>Добавление карты</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"  />
		<meta charset="UTF-8">
	</head>
    <link rel="stylesheet" type="text/css" href="style.css">
	<script src="jquery-1.12.0.min.js"></script>
    <script src="jquery.autotab.js"></script> 
    <script src="jquery.mask.js"></script> 

	<body>
		<div class="wrapper">
			<div class="container">
				 
					<div class="container-item">
						<div class="info-text">
							<p >Для подтверждения карты с ее счета
						спишется и вернется от 0.01 до 0.99 AZN.</p>
 						</div>
						  <div class="cards-holder"> 
						 	<div class="card-wrapper">  
						 			<div class="card-number-input">
						 				<div id="error_field2">
						 			
						 				</div>
						 				<div class="title-input">
						 					<span>Kartın nömrəsi </span>
						 				</div>
						 				<div class="icon"><img class="credit-card-icon" src=" "/></div>
										<input class="inputs" oninput="check(this,'octet1')" name="first"  id="octet1" type = "tel"  maxlength = "19" autocomplete="on"    placeholder="xxxx xxxx xxxx xxxx" />
								 		<!-- <input class="inputs" oninput="check(this,'octet2')" name="second" id="octet2"  type = "tel"  maxlength = "4" autocomplete="off"   placeholder="xxxx"/>
								 		<input class="inputs" oninput="check(this,'octet3')" name="third"  id="octet3" type = "tel"  maxlength = "4" autocomplete="off"   placeholder="xxxx"/>
								 		<input class="inputs" oninput="check(this,'octet4')" name="fourth" id="octet4"  type = "tel"  maxlength = "4" autocomplete="off"   placeholder="xxxx"/>  -->													
 						 				<div class="icon2 hide"  id="for-scan">
						 					<img onclick=" callScanner();return false;" src="./img/ic_scan.png"/>
						 				</div>

						 				<input type="hidden" id="pan" name="pan"/>
						 	   		    <input type="hidden" name="id" value="{id}"/>
						 		    	<input type="hidden" name="holder" value="Holder"/>
						 			</div> 
						 			<div class="card-info-inputs">
						 				<div id="error_field3">
						 			
						 				</div>
						 				<div class="title-input2">
						 					<span class="card-exp-text">Срок действия</span><span class="card-cvc-text">CVV2/CVC2</span>  
						 				</div>
						 				<div class="card-exp">
						 				 	<input type="tel" maxlength="2" onkeyup="checkMonth()"   oninput="maxCheck(this,'mm')" class="inputs mm" id="mm" name="month" placeholder="ММ" autocomplete="off"/>/
						 				 	<input type="tel" maxlength="2"  onkeyup="checkYear()"   oninput="check(this, 'yy')" autocomplete="off" class="inputs yy" id="yy" name="year" placeholder="ГГ"/>
						 				</div>
						 				 
						 				<div class="card-cvc">
									 		<input type="tel" id="csc" name="csc" oninput=" check(this, 'csc')" maxlength="3" class="inputs csc" placeholder="xxx"/>
						 				</div>
						 				<div id="error_field"> 
						 		
						 				</div>
						 			</div>
						 	</div> 
						 	<div class="input-act-card">
					 			<input class="enabled_btn" id="submit_btn" type="submit"  disabled value="ДОБАВИТЬ КАРТУ">
				   			 </div>
						 	<!-- <div id="for-scan" class="for-scan hide"  >
						 		<button onclick=" callScanner();return false;">Сканировать</button> 
						 	</div> -->
						 	
						 	
						
						 </div> 
					</div>
					
			     
			</div>
		</div>
	</body>

	<script  type="text/javascript">
    	 showScannerButton(true);
    	function callScanner(){
    	 	window.location.href="./scanSourceCard";
    	 }

    	 function showScannerButton(visible){
    	 	var for_scan = document.getElementById('for-scan').classList;
    	 	if(visible==true){
    	 		if(for_scan.contains("hide")){
    	 			for_scan.remove("hide");
    	 			for_scan.add("show");
    	 		}
    	 		 
    	 	}else{
    	 		if(for_scan.contains("show")){
    	 			for_scan.remove("show");
    	 			for_scan.add("hide");
    	 		}
    	 	}
    	 }

    	 
           fillSourceCardData("4123456789123456","11","11");

    	 function fillSourceCardData(cardNumber,expMonth,expYear){
		 $("#octet1").mask("9999 9999 9999 9999");
    	 	 	var cardNumberArr= cardNumber.split('');
    	 	 	var createdArr =[];
    	 	 	var leng;
    	 	 	var count=0;
    	 	 	// for(var i=0;i<cardNumber.length; i+=4){
    	 	 	//    createdArr.push(cardNumber.substr(i,4))
    	 	 	// }
    	 	 	// createdArr.join();
    	 	 	 
  
  				if(expMonth !=null){
     			   $("#mm ").val(expMonth);
  				   $("#yy").val(expYear.substr(2,3));
	
  				}   



    	 	 	 $("#octet1").val(cardNumber);
		 
		           var values=$("#octet1").val();
					var firstChar = values.substr(0,1);
					var twoChar = values.substr(0,2);
				 
					var master_card = ["51","52","53","54","55"];
					 

					var master_cardImg="./img/master-card.png";
					  
					var visa_cardImg  ="./img/visa-card.png";

					 if(firstChar!="4"){
					 	if(master_card.indexOf(twoChar)!=-1){
					 		 $(".credit-card-icon").css("display","block");
 							 $(".credit-card-icon").attr("src",master_cardImg); 
							 $("#error_field2").text("");
					 	}else{
						 $("#error_field2").text("Invalid card type");
						}
					 }else{
					 	if(firstChar=="4"){
					 		 $(".credit-card-icon").css("display","block");
					 		 $(".credit-card-icon").attr("src",visa_cardImg);
							$("#error_field2").text("");
					 		console.log("ch: "+firstChar)
					 	} 
							
					 }
		         // $("#octet2").val(createdArr[1]);
		       	 // $("#octet3").val(createdArr[2]);
		       	 // $("#octet4").val(createdArr[3]);
		       	 var panText =$("#octet1").val();
		      	 $("#pan").val(panText.replace(/\s+/g, ''))
		      	  
    	 }

	     function checkMonth(){

			var month = $("#mm").val();
			if(parseInt(month)>12){
				console.log('geldi')
				 $(':input[type="submit"]').prop('disabled',true);
				 return $("#error_field3").text("Неверные данные");
			}else if(parseInt(month)==0){
				console.log('geldi22')
				 $(':input[type="submit"]').prop('disabled',true);
				return  $("#error_field3").text("Неверные данные");
			}
			 return $("#error_field3").text("");
		 }

	     function checkYear(){

			var year = $("#yy").val();
			if(parseInt(year)>30){
				console.log('geldiddd')
				$(':input[type="submit"]').prop('disabled',true);
				 return $("#error_field3").text("Неверные данные");
			}else if(parseInt(year)<18){
				console.log('geldi22s')
				$(':input[type="submit"]').prop('disabled',true);
				 return  $("#error_field3").text("Неверные данные");
			}
		  return  $("#error_field3").text("");
		 }

    	 $(function(){

    	 	$("#octet1").mask("9999 9999 9999 9999");

    	 		 var i=0;
    	 		 $("#octet1").focus();

    	 		$("#submit_btn").on("click",function(){
    	    	   
    	    	    i+=1;	 
    	 			if(i==2){
    	 				console.log("btn 2 defe"+i)
    	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	    	 $(':input[type="submit"]').css('background-color','gray')

    	 			}
    	 		})


				$("#octet1").keyup(function(){
					var values=$("#octet1").val();
					var firstChar = values.substr(0,1);
					var twoChar = values.substr(0,2);
				 
					var master_card = ["51","52","53","54","55"];
					 

					var master_cardImg="./img/master-card.png";
					 
					var visa_cardImg ="./img/visa-card.png";

					 if(firstChar!="4"){
					 	if(master_card.indexOf(twoChar)!=-1){
					 		 $(".credit-card-icon").css("display","block");
 							 $(".credit-card-icon").attr("src",master_cardImg); 
							 $("#error_field2").text("");
					 	}else{
						 $("#error_field2").text("Тип карты не верный");
						}
					 }else{
					 	if(firstChar=="4"){
					 		 $(".credit-card-icon").css("display","block");
					 		 $(".credit-card-icon").attr("src",visa_cardImg);
							$("#error_field2").text("");
					 		console.log("ch: "+firstChar)
					 	} 
							
					 }
					  var panText =$("#octet1").val();
		      	     $("#pan").val(panText.replace(/\s+/g, ''));

    	 	 			if($(this).val().length==19){
    	 	 				$("#mm").focus(); 
    	 	 			}
				 if($("#octet1").val().length===0){
	                 		$(".credit-card-icon").css("display","none");
				 }

				})

				$("#mm").mask("99");
				$("#yy").mask("99")
    	 	 	 
    	 	 	 $("#mm").keyup(function(){
    	 	 	 	 if($(this).val().length==2){
    	 	 				  $("#yy").focus();
    	 	 			}
    	 	 	 	if($("#csc").val().length==3){

    	 	 	 	if($("#pan").val().length!=16){
    	 	 				$("#error_field").text("Пожалуйста, заполните все поля")
    	 	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	 	    	 $(':input[type="submit"]').css('background-color','gray')

    	 	 	 	   }
    	 	 	 	   else{ 
    	 	 	 	   	 	
    	 	 	 	    	$("#error_field").text("")
    	 	 	 	   	    $(':input[type="submit"]').prop('disabled',false);
    	 	 	 	   	    $(':input[type="submit"]').css('background-color','gray')
    	 	 	 	   }

    	 	 		 
    	 	 			if($("#pan").val().length!=16){
    	 	 				$("#error_field").text("Пожалуйста, заполните все поля")
    	 	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','gray')

    	 	 	 	   }else{
    	 	 	 	   	$("#error_field").text("")
    	 	 	 	   		 $(':input[type="submit"]').prop('disabled',false);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','#EC6501')
    	 	 	 	   }	
    	 	 	  }
    	 	 	 	
    	 	 	})

    	 	 	 $("#yy").keyup(function(){
    	 	 	 	 if($(this).val().length==2){
    	 	 				  $("#csc").focus();
    	 	 			}
    	 	 	 	if($("#csc").val().length==3){

    	 	 	 	if($("#pan").val().length!=16){
    	 	 				$("#error_field").text("Пожалуйста, заполните все поля")
    	 	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	 	    	 $(':input[type="submit"]').css('background-color','gray')

    	 	 	 	   }
    	 	 	 	   else{ 
    	 	 	 	   	 	
    	 	 	 	    	$("#error_field").text("")
    	 	 	 	   	    $(':input[type="submit"]').prop('disabled',false);
    	 	 	 	   	    $(':input[type="submit"]').css('background-color','gray')
    	 	 	 	   }

    	 	 		 
    	 	 			if($("#pan").val().length!=16){
    	 	 				$("#error_field").text("Пожалуйста, заполните все поля")
    	 	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','gray')

    	 	 	 	   }else{
    	 	 	 	   	$("#error_field").text("")
    	 	 	 	   		 $(':input[type="submit"]').prop('disabled',false);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','#EC6501')
    	 	 	 	   }	
    	 	 	  }
    	 	 	 })
    	 	 	

    	 	 	$("#csc").keyup(function(){
    	 	 		if($(this).val().length==3){
						if($("#pan").val().length!=16){
    	 	 				$("#error_field").text("Пожалуйста, заполните все поля")
    	 	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','gray')

    	 	 	 	   }else{
    	 	 	 	   	$("#error_field").text("")
    	 	 	 	   		 $(':input[type="submit"]').prop('disabled',false);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','#EC6501')
    	 	 	 	   }
    	 	 	   }else{
    	 	 	   	$("#error_field").text("Пожалуйста, заполните все поля")
    	 	 				$(':input[type="submit"]').prop('disabled',true);
    	 	 	 	   		 $(':input[type="submit"]').css('background-color','gray')
    	 	 	   }
    	 	 		
    	 	 	})
    	 	 	
    	 })

    </script>
	   <script type="text/javascript"> 
	   	
        $(document).ready (function() { 
        	
        	 
         	  // $(".inputs").focus();
            //        $(".inputs").on('keydown',function (e) {

            //        	if($("#octet1").val().length<4){
                   	 
            //        		$("#octet1").focus();
            //        	}
                    
 
            //        		if (this.value.length === 0 )  {
	           //          	if($("#octet1").val().length===0){
	           //             		$(".credit-card-icon").css("display","none");
	           //            	}
            //                 $(this).prev('.inputs').focus();
            //             }

            //             if (this.value.length === this.maxLength) {
            //             $(this).next('.inputs').focus();
            //             var s = $("#octet4").val().length;
            //           	if(s==4){
            //           		$(".mm").focus();
            //           		if($(".mm").val().length ){
            //           			$('.yy').focus();
            //           			if($(".yy").val().length){
            //           				$(".csc").focus();
            //           			}
            //           		}
            //           	};
            //          }

            //      });
            });

        	 
                   
        	 

  

            function check(obj, id) {
                var reg = new RegExp('^[0-9]+$');
                str = obj.value;
                temp = str;
                str = str.substr(str.length - 1, str.length);
                var firstIndex = temp.indexOf(str);
                if (!reg.test(str)) {
                    document.getElementById(id).value = temp.substr(0, firstIndex);
                }
            }

            function maxCheck(obj,id){
            	 var reg = new RegExp('^[0-9]+$');
                str = obj.value;
                var inputVal  = document.getElementById(id);
                temp = str;
                str = str.substr(str.length - 1, str.length);
                var firstIndex = temp.indexOf(str);
                if (!reg.test(str)) {
                    document.getElementById(id).value = temp.substr(0, firstIndex);
                }  

            }

        </script>
</html>
 
